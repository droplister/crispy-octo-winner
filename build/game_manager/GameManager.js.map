{"version":3,"sources":["../../src/game_manager/GameManager.js"],"names":["GameManager","io","spawners","chests","monsters","players","playerLocations","chestLocations","monsterLocations","monsterCount","parseMapData","setupEventListeners","setupSpawners","levelData","layers","forEach","layer","name","objects","obj","push","x","Scale","FACTOR","y","properties","value","on","socket","console","log","id","reason","emit","token","frame","decoded","jwt","verify","process","env","JWT_SECRET","JSON","stringify","username","user","spawnPlayer","broadcast","err","message","playerData","flipX","playerAttacking","currentDirection","chestId","bitcoin","updateBitcoin","spawnerId","removeObject","monsterId","attack","loseHealth","Mode","DIFFICULTY","health","updateHealth","reduceAmount","parseInt","respawn","attackedPlayerId","to","config","spawnInterval","Intervals","DEFAULT","limit","spawnerType","spawner","Object","keys","key","SpawnerType","CHEST","Spawner","addChest","bind","deleteChest","MONSTER","addMonster","deleteMonster","moveMonsters","playerId","player","PlayerModel","chest","monster"],"mappings":"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","sourcesContent":["import jwt from 'jsonwebtoken';\nimport PlayerModel from './PlayerModel';\nimport * as levelData from '../../public/assets/level/large_level.json';\nimport Spawner from './Spawner';\nimport {\n  SpawnerType, Mode, DIFFICULTY, Scale, Intervals,\n} from './utils';\n// in charge of managing game state for player's game\nexport default class GameManager {\n  constructor(io) {\n    this.io = io;\n    this.spawners = {};\n    this.chests = {};\n    this.monsters = {};\n    this.players = {};\n    this.playerLocations = [];\n    this.chestLocations = {};\n    this.monsterLocations = {};\n    this.monsterCount = 0;\n  }\n\n  setup() {\n    this.parseMapData();\n    this.setupEventListeners();\n    this.setupSpawners();\n  }\n\n  parseMapData() {\n    this.levelData = levelData;\n    this.levelData.layers.forEach((layer) => {\n      if (layer.name === 'player_locations') {\n        layer.objects.forEach((obj) => {\n          this.playerLocations.push([obj.x * Scale.FACTOR, obj.y * Scale.FACTOR]);\n        });\n      } else if (layer.name === 'monster_locations') {\n        layer.objects.forEach((obj) => {\n          if (this.monsterLocations[obj.properties[0].value]) {\n            this.monsterLocations[obj.properties[0].value].push([obj.x * Scale.FACTOR, obj.y * Scale.FACTOR]);\n          } else {\n            this.monsterLocations[obj.properties[0].value] = [[obj.x * Scale.FACTOR, obj.y * Scale.FACTOR]];\n          }\n        });\n      } else if (layer.name === 'chest_locations') {\n        layer.objects.forEach((obj) => {\n          if (this.chestLocations[obj.properties[0].value]) {\n            this.chestLocations[obj.properties[0].value].push([obj.x * Scale.FACTOR, obj.y * Scale.FACTOR]);\n          } else {\n            this.chestLocations[obj.properties[0].value] = [[obj.x * Scale.FACTOR, obj.y * Scale.FACTOR]];\n          }\n        });\n      }\n    });\n  }\n\n  setupEventListeners() {\n    this.io.on('connection', (socket) => {\n      // when a player connects\n      console.log('player connected to our game');\n      console.log(socket.id);\n      socket.on('disconnect', (reason) => {\n        // delete userdata from server\n        delete this.players[socket.id];\n        // emit message to remove this player\n        this.io.emit('playerDisconnect', socket.id);\n        // when a player disconnects\n        console.log(`player disconnected from game because: ${reason}`);\n        console.log(socket.id);\n      });\n\n      socket.on('newPlayer', (token, frame) => {\n        try {\n          // validate token\n          const decoded = jwt.verify(token, process.env.JWT_SECRET);\n          // get players name\n          console.log(`new player, with decoded value of ${JSON.stringify(decoded)}`);\n          console.log(`this is the frame going to the server from newPlayer on socket ${frame}`);\n          const { username } = decoded.user;\n          this.spawnPlayer(socket.id, username, frame);\n\n          // send players to new player\n          socket.emit('currentPlayers', this.players);\n          // send monsters to new player\n          socket.emit('currentMonsters', this.monsters);\n          // send chests to new player\n          socket.emit('currentChests', this.chests);\n          // send new player to all players\n          socket.broadcast.emit('spawnPlayer', this.players[socket.id]);\n        } catch (err) {\n          // reject login\n          console.log(`err with validating jwt token ${err.message}`);\n          socket.emit('invalidToken');\n        }\n      });\n      socket.on('playerMovement', (playerData) => {\n        if (this.players[socket.id]) {\n          this.players[socket.id].x = playerData.x;\n          this.players[socket.id].y = playerData.y;\n          this.players[socket.id].flipX = playerData.flipX;\n          this.players[socket.id].playerAttacking = playerData.playerAttacking;\n          this.players[socket.id].currentDirection = playerData.currentDirection;\n\n          // emit message to all players letting them know about the updated position\n          this.io.emit('playerMoved', this.players[socket.id]);\n        }\n      });\n      socket.on('pickUpChest', (chestId) => {\n        // update spawner\n        if (this.chests[chestId]) {\n          // short hand for setting bitcoin variable from chests[chestId].bitcoin this is probably a bad idea.. just trying to learn javascript and see if this works.\n          const { bitcoin } = this.chests[chestId];\n\n          // updating player balance\n          this.players[socket.id].updateBitcoin(bitcoin);\n          socket.emit('updateBalance', this.players[socket.id].bitcoin);\n\n          // remove chest this somehow calls deleteChest event (need to verify this).\n          this.spawners[this.chests[chestId].spawnerId].removeObject(chestId);\n        }\n      });\n      socket.on('monster', (monsterId) => {\n        // update spawner\n        // console.log('debug: '+ Object.keys(this.players[playerId]));\n        // console.log('playerid: '+playerId);\n        if (this.monsters[monsterId]) {\n          const { bitcoin, attack } = this.monsters[monsterId];\n          this.monsters[monsterId].loseHealth(2 * Mode[DIFFICULTY]);\n          // console.log('health' + this.monsters[monsterId].health);\n          // check health remove monster if dead\n          if (this.monsters[monsterId].health <= 0) {\n            this.players[socket.id].updateBitcoin(bitcoin);\n            socket.emit('updateBalance', this.players[socket.id].bitcoin);\n            // console.log('health2' + this.monsters[monsterId].health);\n            this.spawners[this.monsters[monsterId].spawnerId].removeObject(monsterId);\n            this.io.emit('monsterRemoved', monsterId);\n            // give player some more health if they kill a monster\n            this.players[socket.id].updateHealth(-10);\n            this.io.emit('updatePlayerHealth', socket.id, this.players[socket.id].health);\n          } else {\n            this.players[socket.id].updateHealth(attack);\n            // update player health\n            this.io.emit('updatePlayerHealth', socket.id, this.players[socket.id].health);\n            // update monster health\n            this.io.emit('updateMonsterHealth', monsterId, this.monsters[monsterId].health);\n\n            // respawn player if he be ded\n            if (this.players[socket.id].health <= 0) {\n              // update balance to take a 50% penalty\n              // 10 represents the \"radix\" i believe this should be 10 for base 10 numbering\n              const reduceAmount = parseInt(-this.players[socket.id].bitcoin / 2, 10);\n              // console.log(reduceAmount);\n              this.players[socket.id].updateBitcoin(reduceAmount);\n              socket.emit('updateBalance', this.players[socket.id].bitcoin);\n              // respawn\n              this.players[socket.id].respawn(this.players);\n              this.io.emit('respawnPlayer', this.players[socket.id]);\n            }\n          }\n        }\n      });\n      socket.on('attackedPlayer', (attackedPlayerId) => {\n        if (this.players[attackedPlayerId]) {\n          // get balance\n          const { bitcoin } = this.players[attackedPlayerId];\n          // subtract health\n          this.players[attackedPlayerId].updateHealth(10);\n          // check health of attacked player if dead send gold to attacker\n          if (this.players[attackedPlayerId].health <= 0) {\n            // dead player loses half of the gold to attacker\n            this.players[socket.id].updateBitcoin(bitcoin);\n            // respawn attacked player\n            this.players[attackedPlayerId].respawn(this.players);\n            this.io.emit('respawnPlayer', this.players[attackedPlayerId]);\n            // send update balance message to player\n            socket.emit('updateBalance', this.players[socket.id].bitcoin);\n            // reset dead players gold\n            this.players[attackedPlayerId].updateBitcoin(-bitcoin);\n            // io.to sends to a specific socket\n            this.io.to(`${attackedPlayerId}`).emit('updateBalance', this.players[attackedPlayerId].bitcoin);\n            // add bonus health to player\n            this.players[socket.id].updateHealth(-20);\n            this.io.emit('updatePlayerHealth', socket.id, this.players[socket.id].health);\n          } else {\n            this.io.emit('updatePlayerHealth', attackedPlayerId, this.players[attackedPlayerId].health);\n          }\n        }\n      });\n      console.log('new player connected', socket.id);\n    });\n  }\n\n  setupSpawners() {\n    const config = {\n      spawnInterval: Intervals.DEFAULT,\n      limit: 3,\n      spawnerType: '',\n      id: '',\n    };\n    let spawner;\n    Object.keys(this.chestLocations).forEach((key) => {\n      config.id = `chest-${key}`;\n      config.spawnerType = SpawnerType.CHEST;\n      spawner = new Spawner(\n        config,\n        this.chestLocations[key],\n        this.addChest.bind(this),\n        this.deleteChest.bind(this),\n      );\n      this.spawners[spawner.id] = spawner;\n    });\n\n    Object.keys(this.monsterLocations).forEach((key) => {\n      config.id = `monster-${key}`;\n      config.spawnerType = SpawnerType.MONSTER;\n      if (this.monsterCount === 0) {\n        spawner = new Spawner(\n          config,\n          this.monsterLocations[key],\n          this.addMonster.bind(this),\n          this.deleteMonster.bind(this),\n          this.moveMonsters.bind(this),\n        );\n        this.spawners[spawner.id] = spawner;\n        this.monsterCount += 1;\n      }\n    });\n  }\n\n  spawnPlayer(playerId, username, frame) {\n    const player = new PlayerModel(playerId, this.playerLocations, this.players, username, frame);\n    this.players[playerId] = player;\n  }\n\n  addChest(chestId, chest) {\n    this.chests[chestId] = chest;\n    this.io.emit('chestSpawned', chest);\n  }\n\n  deleteChest(chestId) {\n    delete this.chests[chestId];\n    this.io.emit('chestRemoved', chestId);\n  }\n\n  addMonster(monsterId, monster) {\n    this.monsters[monsterId] = monster;\n    this.io.emit('monsterSpawned', monster);\n  }\n\n  deleteMonster(monsterId) {\n    delete this.monsters[monsterId];\n    this.io.emit('monsterRemoved', monsterId);\n  }\n\n  moveMonsters() {\n    this.io.emit('monsterMovement', this.monsters);\n  }\n}\n"],"file":"GameManager.js"}